<f-flow fDraggable (fLoaded)="onLoaded()">
  <!-- Background -->
  <f-background>
    <f-circle-pattern />
    <!-- <f-rect-pattern /> -->
  </f-background>

  <f-canvas
    [fZoom]="true"
    [fZoomStep]="0.4"
    [fZoomMaximum]="1.5"
    [fZoomMinimum]="0.1"
    (fCanvasChange)="onCanvasChange($event)">
    <!-- Groups -->
    @for (group of elkGroups(); track $index) {
      <div
        fGroup
        fDragHandle
        [fGroupId]="group.id"
        [fGroupPosition]="group.position!"
        [fGroupDraggingDisabled]="false"
        [fGroupSize]="group.size">
        Group {{ $index + 1 }}
      </div>
    }

    <!-- Nodes -->
    @for (node of elkNodes(); track node.id) {
      <div
        fNode
        fDragHandle
        [fNodeId]="node.id"
        [fNodePosition]="node.position!"
        [fNodeDraggingDisabled]="false"
        [fNodeSize]="node.size"
        [fNodeParentId]="node.parentId">
        Node {{ $index + 1 }}

        <!-- Left Connected Handle -->
        <div
          fNodeInput
          fInputConnectableSide="calculate_horizontal"
          [fInputId]="node.id"
          fInputConnectableSide="calculate_horizontal"></div>

        <!-- Right Connected Handle -->
        <div
          fNodeOutput
          fOutputConnectableSide="calculate_horizontal"
          [fOutputId]="node.id"
          fOutputConnectableSide="calculate_horizontal"></div>
      </div>
    }

    <!-- Edges -->
    @for (edge of elkEdges(); track edge.id) {
      <f-connection
        fBehavior="fixed"
        fType="segment"
        [fConnectionId]="edge.id"
        [fOutputId]="edge.source"
        [fInputId]="edge.target">
      </f-connection>
    }
  </f-canvas>

  <div class="any-container-or-without-container">
    <f-minimap [fMinSize]="2000"></f-minimap>
  </div>

  <div class="layout-controls">
    <!-- Enable Groups Toggle -->
    <div class="control-group">
      <label for="enableGroups">Enable Groups:</label>
      <input
        type="checkbox"
        id="enableGroups"
        [checked]="enableGroupsSignal()"
        (change)="onEnableGroupsChange($event)" />
    </div>

    <!-- Algorithm Selection -->
    <div class="control-group">
      <label for="algorithm">Layout Algorithm:</label>
      <select
        id="algorithm"
        [value]="selectedAlgorithm()"
        (change)="onAlgorithmChange($event)">
        @for (option of algorithmOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>

    <!-- Direction Selection -->
    <div class="control-group">
      <label for="direction">Direction:</label>
      <select
        id="direction"
        [value]="selectedDirection()"
        (change)="onDirectionChange($event)"
        [disabled]="
          selectedAlgorithm() === 'force' || selectedAlgorithm() === 'stress'
        ">
        @for (option of directionOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>

    <!-- Edge Routing -->
    <div class="control-group">
      <label for="edgeRouting">Edge Routing:</label>
      <select
        id="edgeRouting"
        [value]="selectedEdgeRouting()"
        (change)="onEdgeRoutingChange($event)"
        [disabled]="selectedAlgorithm() !== 'layered'">
        @for (option of edgeRoutingOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>

    <!-- Node Placement Strategy -->
    <div class="control-group">
      <label for="nodePlacement">Node Placement:</label>
      <select
        id="nodePlacement"
        [value]="selectedNodePlacement()"
        (change)="onNodePlacementChange($event)"
        [disabled]="selectedAlgorithm() !== 'layered'">
        @for (option of nodePlacementOptions; track option.value) {
          <option [value]="option.value">{{ option.label }}</option>
        }
      </select>
    </div>

    <!-- Node Spacing -->
    <div class="control-group">
      <label for="nodeSpacing">Node Spacing:</label>
      <input
        type="range"
        id="nodeSpacing"
        min="20"
        max="200"
        [value]="nodeSpacing()"
        (input)="onNodeSpacingChange($event)" />
      <span class="value-display">{{ nodeSpacing() }}px</span>
    </div>

    <!-- Layer Spacing -->
    <div class="control-group">
      <label for="layerSpacing">Layer Spacing:</label>
      <input
        type="range"
        id="layerSpacing"
        min="20"
        max="200"
        [value]="layerSpacing()"
        (input)="onLayerSpacingChange($event)"
        [disabled]="selectedAlgorithm() !== 'layered'" />
      <span class="value-display">{{ layerSpacing() }}px</span>
    </div>

    <!-- Group Padding -->
    <div class="control-group">
      <label for="groupPadding">Group Padding:</label>
      <input
        type="range"
        id="groupPadding"
        min="10"
        max="150"
        [value]="groupPadding()"
        (input)="onGroupPaddingChange($event)"
        [disabled]="!enableGroupsSignal()" />
      <span class="value-display">{{ groupPadding() }}px</span>
    </div>
  </div>
</f-flow>
